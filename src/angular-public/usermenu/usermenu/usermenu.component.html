<div
  class="sbb-usermenu-logged-in"
  tabindex="0"
  [class.sbb-usermenu-hidden]="!userName"
  [class.sbb-usermenu-logged-in-active]="panelOpen"
  (click)="open()"
>
  <div
    class="sbb-usermenu-logged-in-collapsed"
    [class.sbb-usermenu-logged-in-collapsed-dropdown-expanded]="panelOpen"
  >
    <ng-container *ngIf="userName && userName.length">
      <div class="sbb-usermenu-logged-in-collapsed-user-icon sbb-icon-fit">
        <div #icon [class.sbb-usermenu-logged-in-collapsed-icon]="icon.children.length">
          <ng-content select="[sbbIcon]"></ng-content>
        </div>
        <div class="sbb-usermenu-logged-in-collapsed-initial-letters" *ngIf="!icon.children.length">
          <div>{{ getInitialLetters() }}</div>
        </div>
      </div>
      <div
        class="sbb-usermenu-logged-in-expanded-info-user"
        [class.sbb-usermenu-logged-in-expanded-info-user-dropdown-open]="panelOpen"
      >
        <div
          class="sbb-usermenu-logged-in-expanded-displayName"
          [class.sbb-displayName-logged-in-collapsed]="!panelOpen"
        >
          {{ displayName || userName }}
        </div>
        <div class="sbb-usermenu-logged-in-expanded-username" *ngIf="panelOpen && displayName">
          {{ userName }}
        </div>
      </div>
      <div
        class="sbb-usermenu-logged-in-collapsed-arrow sbb-icon-fit"
        *ngIf="userName && userName.length && !panelOpen"
      >
        <sbb-icon svgIcon="kom:chevron-small-down-small"></sbb-icon>
      </div>
    </ng-container>
    <div class="sbb-usermenu-logged-in-expanded-arrow-above">
      <div class="sbb-usermenu-logged-in-expanded-arrow sbb-icon-fit" *ngIf="panelOpen">
        <sbb-icon svgIcon="kom:chevron-small-down-small"></sbb-icon>
      </div>
    </div>
  </div>
</div>
<div class="sbb-usermenu-logged-off" *ngIf="!userName">
  <button class="sbb-usermenu-logged-off-button sbb-icon-fit" (click)="emitLogin()" type="button">
    <sbb-icon svgIcon="kom:user-small"></sbb-icon>
    <span class="sbb-usermenu-logged-off-label" i18n="Button label for login@@sbbUsermenuLogin"
      >Login</span
    >
  </button>
</div>

<ng-template
  cdk-connected-overlay
  cdkConnectedOverlayLockPosition
  cdkConnectedOverlayFlexibleDimensions
  [cdkConnectedOverlayMinHeight]="_triggerRect?.height!"
  [cdkConnectedOverlayWidth]="_overlayWidth"
  cdkConnectedOverlayHasBackdrop
  cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
  cdkConnectedOverlayPanelClass="sbb-overlay-panel"
  [cdkConnectedOverlayScrollStrategy]="_scrollStrategy"
  [cdkConnectedOverlayOrigin]="{ elementRef: _elementRef }"
  [cdkConnectedOverlayOpen]="panelOpen"
  [cdkConnectedOverlayPositions]="_positions"
  [cdkConnectedOverlayOffsetX]="0"
  (backdropClick)="close()"
  (detach)="close()"
>
  <div
    #panel
    tabindex="-1"
    class="sbb-usermenu-panel sbb-scrollbar"
    [attr.id]="id + '-panel'"
    [@transformPanel]="{ value: 'showing', params: { width: _overlayWidth + 'px' } }"
  >
    <div class="sbb-usermenu-inner-panel">
      <ng-content select="a[sbb-usermenu-item],button[sbb-usermenu-item],hr"></ng-content>
    </div>

    <!---     (keydown)="_handleKeydown($event)"
 --->
  </div>
</ng-template>
